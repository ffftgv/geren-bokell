name: Sync Gitee to GitHub

on:
  workflow_dispatch:
  schedule:
    - cron: '*/20 * * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync Repository
        run: |
          # 1. 克隆Gitee仓库
          git clone https://gitee.com/wzjwwcom/personal-blog.git repo
          echo "✅ 成功通过Git克隆仓库"
          
          # 2. 进入仓库目录
          cd repo
          
          # 3. 移除所有可能存在的远程配置（关键修复点）
          git remote remove origin 2>/dev/null || true
          git remote remove github 2>/dev/null || true
          
          # 4. 获取正确的GitHub仓库URL
          OWNER="${GITHUB_REPOSITORY%%/*}"
          REPO="${GITHUB_REPOSITORY#*/}"
          GITHUB_URL="https://x-access-token:${{ github.token }}@github.com/$OWNER/$REPO.git"
          
          echo "🔍 当前GitHub仓库: $OWNER/$REPO"
          echo "🔗 正在推送到: $GITHUB_URL"
          
          # 5. 配置Git用户信息
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          # 6. 添加正确的GitHub远程（确保URL格式正确，无多余空格）
          git remote add origin "$GITHUB_URL"
          
          # 7. 推送所有分支和标签
          git push -u origin --all --force
          git push -u origin --tags --force

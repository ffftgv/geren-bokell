name: Sync Gitee to GitHub

on:
  workflow_dispatch:
  schedule:
    - cron: '*/20 * * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync Repository
        run: |
          # 1. å…‹éš†Giteeä»“åº“
          git clone https://gitee.com/wzjwwcom/personal-blog.git repo
          echo "âœ… æˆåŠŸé€šè¿‡Gitå…‹éš†ä»“åº“"
          
          # 2. è¿›å…¥ä»“åº“ç›®å½•
          cd repo
          
          # 3. ç§»é™¤æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¿œç¨‹é…ç½®ï¼ˆå…³é”®ä¿®å¤ç‚¹ï¼‰
          git remote remove origin 2>/dev/null || true
          git remote remove github 2>/dev/null || true
          
          # 4. è·å–æ­£ç¡®çš„GitHubä»“åº“URL
          OWNER="${GITHUB_REPOSITORY%%/*}"
          REPO="${GITHUB_REPOSITORY#*/}"
          GITHUB_URL="https://x-access-token:${{ github.token }}@github.com/$OWNER/$REPO.git"
          
          echo "ğŸ” å½“å‰GitHubä»“åº“: $OWNER/$REPO"
          echo "ğŸ”— æ­£åœ¨æ¨é€åˆ°: $GITHUB_URL"
          
          # 5. é…ç½®Gitç”¨æˆ·ä¿¡æ¯
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          # 6. æ·»åŠ æ­£ç¡®çš„GitHubè¿œç¨‹ï¼ˆç¡®ä¿URLæ ¼å¼æ­£ç¡®ï¼Œæ— å¤šä½™ç©ºæ ¼ï¼‰
          git remote add origin "$GITHUB_URL"
          
          # 7. æ¨é€æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾
          git push -u origin --all --force
          git push -u origin --tags --force

name: Sync Gitee to GitHub

on:
  workflow_dispatch:
  schedule:
    - cron: '*/20 * * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” è°ƒè¯•ç¯å¢ƒä¿¡æ¯
        run: |
          echo "======================================"
          echo "å½“å‰ GitHub ä»“åº“ä¸Šä¸‹æ–‡:"
          echo "GITHUB_REPOSITORY = ${{ github.repository }}"
          echo "GITHUB_REPOSITORY_OWNER = ${{ github.repository_owner }}"
          echo "GITHUB_ACTOR = ${{ github.actor }}"
          echo "GITHUB_REF = ${{ github.ref }}"
          echo "GITHUB_WORKSPACE = $GITHUB_WORKSPACE"
          echo "======================================"
          echo "æ‚¨çš„ä»“åº“ä¿¡æ¯:"
          echo "ä»“åº“æ‰€æœ‰è€… = ${{ github.repository_owner }}"
          echo "ä»“åº“åç§° = geren-bokell"
          echo "å®Œæ•´ä»“åº“è·¯å¾„ = ${{ github.repository_owner }}/geren-bokell"
          echo "======================================"

      - åå­—: ğŸ”„ åŒæ­¥ä»“åº“
        run: |
          # 1. å…‹éš†Giteeä»“åº“
          git clone https://gitee.com/wzjwwcom/personal-blog.git repo
          echo "âœ… æˆåŠŸé€šè¿‡Gitå…‹éš†Giteeä»“åº“"
          
          # 2. è¿›å…¥ä»“åº“ç›®å½•
          cd repo
          
          # 3. ç§»é™¤æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¿œç¨‹é…ç½®
          git remote remove origin 2>/dev/null || true
          git remote remove github 2>/dev/null || true
          
          # 4. ä½¿ç”¨æ­£ç¡®çš„ä»“åº“URLæ ¼å¼ï¼ˆå…³é”®ï¼šç¡®ä¿æ— å¤šä½™ç©ºæ ¼ï¼‰
          REPO_OWNER="${{ github.repository_owner }}"
          GITHUB_URL="https://x-access-token:${{ github.token }}@github.com/$REPO_OWNER/geren-bokell.git"
          
          echo "======================================"
          echo "æ­£åœ¨ä½¿ç”¨ä»¥ä¸‹URLæ¨é€:"
          echo "$GITHUB_URL"
          echo "======================================"
          
          # 5. é…ç½®Gitç”¨æˆ·ä¿¡æ¯
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          # 6. æ·»åŠ GitHubè¿œç¨‹
          git remote add origin "$GITHUB_URL"
          
          # 7. æ£€æŸ¥è¿œç¨‹é…ç½®
          echo "å½“å‰é…ç½®çš„è¿œç¨‹ä»“åº“:"
          git remote -v
          
          # 8. æ¨é€æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾
          git push -u origin --all --force
          git push -u origin --tags --force
